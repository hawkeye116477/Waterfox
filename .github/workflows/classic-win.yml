name: Build Classic for Windows

on:
  pull_request:
    branches:
      - classic
  workflow_dispatch: null

env:
  ENABLE_ARTIFACTS_MODE: "true"
  MOZCONFIG: "./.mozconfig-ga"
  SHELL: "/bin/bash"

jobs:
  windows:
    runs-on: windows-latest
    steps:
      - name: Checkout branch
        uses: actions/checkout@v2
      - name: Set build directory
        run: |
          $pattern = '[\\]'
          $BUILD_DIR = $env:GITHUB_WORKSPACE -replace $pattern, '/'
          echo "${BUILD_DIR}"
          echo "G_WORKSPACE=${BUILD_DIR}" | Out-File -FilePath $Env:GITHUB_ENV -Encoding utf8 -Append
      - name : Install nasm
        uses: ilammy/setup-nasm@v1
      - name: Install MozillaBuild
        run: |
          choco install mozillabuild
      - name: Build
        run: |
          echo "C:\msys64\mingw32\bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8
          c:\\mozilla-build\\start-shell.bat "$Env:G_WORKSPACE/build/github-actions/build.sh"
